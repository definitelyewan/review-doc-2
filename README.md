# Running on a server

- make sure apache/nginx is running
- make a rule for the directory in nginx/apache
- make a rule for the build folder in systemd so it starts as a service
- chmod +x on index.js in build/
- copy node shabang onto index.js in build/
- create a .env file with all required variables
- profit

# Setup
- ensure mariadb, node, and, npm are installed
- create a mariadb user with read and write on a new database
- run npm install in the project directory
- create a .env file with the following:
```sh
DB_HOST=<maria db IP>
DB_USER=<maria db user name>
DB_PASSWORD=<mariadb users password>>
DB_NAME=<mariadb database name>
DB_CHARSET=utf8mb4
DB_PORT=<mariadb port (probably 3306)>

REVIEW_DOC_API_KEY=<an API key for the single user>

REVIEW_DOC_BACKUP_DIR=<absolute path to a backup directory for database snapshots>

REVIEW_DOC_IGDB_CLIENT_ID=<igdb client id>
REVIEW_DOC_IGDB_SECRET_ID=<igdb secret id>

REVIEW_DOC_TMDB_READ_ACCESS_TOKEN=<tmdb access token>
REVIEW_DOC_SEED=<16 character 2fa seed>

```
- run ``npm install``
- run ``npm run dev`` or ``npm run build``
- profit

# Tech stack
- mariadb
- node
- svelte kit 5
- tailwind
- skeleton ui 3

# API documentation
## Auth
Provides a timed token used to access the rest of the API once the user authenticates. The token generated by this endpoint is required to access all other endpoints.

### Request
```
POST https://url/api/auth
HEADER:
BODY:
{"password" : "password", "token" : "2FA token"}
```
### Response
```
{"token" : "response"}
```
## db
Provides an endpoint for backing up and rebuilding the internal database. There is one variable for this endpoint called type. when type is set to rebuild it will remake all internal databases and when it is set to backup it will create a database snapshot.
### Request
```
POST https://url/api/db?type=backup
HEADER:
- Authorization : "auth token"
BODY:
```
### Response
```
{"message" : "OK"}
```
## Edit
Provides an endpoint for editing the internal database columns. All keys reqresent a column that will be edited in each block. Each block must have an id and type key refering to the rows id and the table name.
### Request
```
POST https://url/api/edit
HEADER:
- Authorization : "auth token"
BODY:
[
  {
    "id"  :  1,
    "type"  :  "award",
    "data"  :  {
      "award_name"  :  "test name 55",
      "award_granted"  :  false

    }

  },
  {
    "id"  :  298,
    "type"  :  "item",
    "data"  :  {
      "item_name"  :  "test name 3",
      "item_date"  :  "2020-02-10"
    }
  }
]

```
### Response
```
{"message" : "OK"}
```
## Upload
Provides a way to upload content manually or automatically. If some keys are not provided they will be assumed via TMDB or IGDB. Each block must have a key called type containing the name of the table that is being uploaded to.
### Request
```
POST https://url/api/upload
HEADER:
- Authorization : "auth token"
BODY:
[
  {
    "type"  :  "list",
    "data"  :  {
      "list_name"  :  "Test List",
      "list_desc"  :  "test desc",
      "list_item"  :  [100,  150,  200,  50,  250]
    }
  },
  {
    "type"  :  "item",
    "data"  :  {
      "external_id"  :  1078605,
      "item_type"  :  "movie"
    }
  }
]
```
### Response
```
{"message" : "OK"}
```
## View  
Provides a way to view a table row in full. This GET request requires two url variables, term and type. Term is the name of what you are looking for and type is the table name. 
### Request
```
GET https://url/api/view?term=Nope&type=review
HEADER:
- Authorization : "auth Token"
BODY:
```
### Response
```
{"message" : "OK"}
```
